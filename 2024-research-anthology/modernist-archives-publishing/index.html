<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

  <meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


  <title>Modernist Archives Publishing Project</title>  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    .prj-lead {
      weight: 400; /* Matches the size of the main title */
      color: #734675; /* Plum purple color */ /* Adds some space between the two titles */
    }
  </style>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/cesta-online/anthology-assets@latest/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/cesta-online/anthology-assets@latest/css/style-quarto.css">
  <script src="https://cdn.jsdelivr.net/gh/cesta-online/anthology-assets@latest/js/script.js"></script>
  
<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
    <script id="quarto-search-options" type="application/json">{
      "location": "sidebar",
      "copy-button": false,
      "collapse-after": 3,
      "panel-placement": "start",
      "type": "textbox",
      "limit": 50,
      "keyboard-shortcut": [
        "f",
        "/",
        "s"
      ],
      "show-item-context": false,
      "language": {
        "search-no-results-text": "No results",
        "search-matching-documents-text": "matching documents",
        "search-copy-link-title": "Copy link to search",
        "search-hide-matches-text": "Hide additional matches",
        "search-more-match-text": "more match in this document",
        "search-more-matches-text": "more matches in this document",
        "search-clear-button-title": "Clear",
        "search-text-placeholder": "",
        "search-detached-cancel-button-title": "Cancel",
        "search-submit-button-title": "Submit",
        "search-label": "Search"
      }
    }</script>
  
  
  </head>

<body>

    <div id="quarto-search-results"></div>
    <!-- content -->
    <div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
    <!-- sidebar -->
    <!-- margin-sidebar -->
        <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
            <nav id="TOC" role="doc-toc" class="toc-active">
        <h2 id="toc-title">Contents</h2>
       
      <ul>
      <li><a href="#born-analog-made-digital" id="toc-born-analog-made-digital" class="nav-link active" data-scroll-target="#born-analog-made-digital">Born Analog, Made Digital</a></li>
      </ul>
    </nav>
        </div>
    <!-- main -->
    <main class="content" id="quarto-document-content">
  
    <header id="title-block-header">
      <p class="session">Summer 2024</p>
      <h1 class="title display-7">Modernist Archives Publishing Project</h1>
        <h1 class="prj-lead">Project Lead: Alice Staveley</h1> <!-- New title added -->
        <div class="project-description-container">
        <p class="project-description">The Modernist Archives Publishing Project is a critical digital archive of early 20th-century publishing history. With rich metadata, the site displays, curates, and describes documents that contribute to the “life cycle” of a book. It uncovers the often invisible industry actors—editors, illustrators, reviewers, printers—who bring works into the public eye. The collection contains thousands of images from archives and special collections relating in the first instance to Virginia and Leonard Woolf’s Hogarth Press—letters, dust jackets, financial records, paper samples, illustrations, sketches, production sheets, and other “ephemera”—but is actively expanding into other presses, with the long term goal of building the infrastructure currently lacking in book historical studies to engage a comprehensive comparative landscape of 20th-century book publishing.</p>
      </div>
      
    </header>
    <!-- <div class="header-img-container">
      <img src="data/imgs/placeholder.jpg" alt=" header image"></img>
    </div>
     -->
    <div class="project-details-container">
        <div class="project-members-container">
        <div class="d-sm-none d-block">
          <h4 class="anchored">Project Members</h4>
        </div>
        <div class="row d-sm-flex d-none">
          <div class="col-sm">
            <p>Project Member</p>
          </div>
          <div class="col-sm">
            <p>Designation</p>
          </div>
          <div class="col-sm">
            <p class="orcid">ORCID</p>
          </div>
        </div>
            <div class="project-member row">
          <div class="col-sm">
            <p class="name">Dr.&nbsp;Alice Staveley</p>
          </div>
          <div class="col-sm">
            <p class="designation">Senior Lecturer in the English Department</p>
          </div>
          <div class="col-sm"><a href="https://orcid.org/0000-0000-0000-0000" target="_blank" class="orcid">0000-0000-0000-0000</a></div>
        </div>
            <div class="project-member row">
          <div class="col-sm">
            <p class="name">Sophie Wu</p>
          </div>
          <div class="col-sm">
            <p class="designation">Intern - Summer, 2024</p>
          </div>
          <div class="col-sm"><a href="https://orcid.org/0000-0000-0000-0000" target="_blank" class="orcid">0000-0000-0000-0000</a></div>
        </div>
          </div>
        
    </div>  

      
  <section id="born-analog-made-digital" class="level1">
  <h1>Born Analog, Made Digital</h1>
  <div class="article-author">
  <p>Sophie Wu</p>
  </div>
  <p>Overall, my work on this project focused on experimenting with ways of applying digital tools to transcribe text from archival images related to Virginia Woolf—largely her reading notebooks and financial records from the publishing company she ran, The Hogarth Press. Creating machine-readable versions of these images would hopefully allow for new and novel inquiry into Woolf, her reach, and the economics not only of the business she ran, but the impact that it had on the early 20th-century book industry at large.</p>
  <p>My work over the summer was largely divided between these two bodies of images.</p>
  <p>For her reading notebooks, I wrote code to both scrape and prepare images for automatic transcription, otherwise known as optical character recognition (OCR), on the platform Transkribus. This process mainly involved automatic scaling and cropping, binarization (turning the images black and white) and de-noising the images. Once the images were ready, they were fed into Transkribus, which automatically output its best guess at what Woolf had written. Given that these transcriptions were imperfect, I then fine tuned the model internal to Transkribus in an attempt to improve its performance. To do so, I compared the Transkribus output to a manual, verifiably correct, “ground-truth” transcription, and corrected the Transkribus output. Following this, I also put together a dataset of the final Transkribus transcriptions as compared to the “ground-truth” transcriptions, which could potentially be used for future fine-tuning of other types of OCR AI models.</p>
  <div id="fig-woolfnotes" class="quarto-layout-panel">
  <figure class="quarto-float quarto-float-fig figure">
  <div aria-describedby="fig-woolfnotes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  <div class="quarto-layout-row">
  <div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
  <div id="woolfnotes-raw" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/woolfnotes_raw.png" class="img-fluid figure-img"></p>
  <figcaption>Fig. 1. (a) An archival image of Woolf’s reading notebook.</figcaption>
  </figure>
  </div>
  </div>
  <div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
  <div id="woolfnotes-processed" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/woolfnotes_processed.png" class="img-fluid figure-img"></p>
  <figcaption>(b) The same image after processing</figcaption>
  </figure>
  </div>
  </div>
  </div>
  </div>
  <figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-woolfnotes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  Figure&nbsp;1: A comparison of an original archival image and the image after it’s been transformed in preparation for OCR.
  </figcaption>
  </figure>
  </div>
  <div class="quarto-figure quarto-figure-center">
  <figure class="figure">
  <p><img src="data/imgs/transkribus.png" class="img-fluid figure-img"></p>
  <figcaption>Fig. 2. A depiction of working with Woolf’s notes in Transkribus. The transcription is output on the right.</figcaption>
  </figure>
  </div>
  <p>For the financial records from Hogarth Press, I largely worked with Google’s Gemini, a large-language model (LLM) similar to ChatGPT. In doing this, I researched and experimented with the design of different prompts to best extract tabular and heterogenous data. In parallel, I also wrote code and modified computer vision algorithms to improve the accuracy of automatic image segmentation, which in turn makes Gemini’s transcriptions more accurate.</p>
  <div class="quarto-figure quarto-figure-center">
  <figure class="figure">
  <p><img src="data/imgs/orderbook.jpg" class="img-fluid figure-img" style="width:80.0%"></p>
  <figcaption>Fig. 3. An archival image of a page from a Hogarth Press Orderbook</figcaption>
  </figure>
  </div>
  <div id="fig-orderbook-cv" class="quarto-layout-panel">
  <figure class="quarto-float quarto-float-fig figure">
  <div aria-describedby="fig-orderbook-cv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  <div class="quarto-layout-row">
  <div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
  <div id="orderbook-dilate" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/dilate.jpg" class="img-fluid figure-img"></p>
  <figcaption>Fig. 4. (a) Dilate</figcaption>
  </figure>
  </div>
  </div>
  <div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
  <div id="orderbook-grouped" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/grouped.jpg" class="img-fluid figure-img"></p>
  <figcaption>(b) Group</figcaption>
  </figure>
  </div>
  </div>
  <div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
  <div id="orderbook-bounds" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/final_bounds.jpg" class="img-fluid figure-img"></p>
  <figcaption>(c) Boundaries</figcaption>
  </figure>
  </div>
  </div>
  </div>
  </div>
  <figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orderbook-cv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  Figure&nbsp;2: A depiction of the process used to detecting columns using computer vision techniques. The image is binarized and dilated to produce (a), from which the features are detected and grouped as in (b). The groups are then used to adjust the boundaries of each column in the image as visualized in (c).
  </figcaption>
  </figure>
  </div>
  <div id="fig-orderbook-transcribed" class="quarto-layout-panel">
  <figure class="quarto-float quarto-float-fig figure">
  <div aria-describedby="fig-orderbook-transcribed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  <div class="quarto-layout-row">
  <div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
  <div id="orderbook-crop" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/buyer_crop.jpg" class="img-fluid figure-img"></p>
  <figcaption>Fig. 5. (a) Crop</figcaption>
  </figure>
  </div>
  </div>
  <div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
  <div id="orderbook-transcribed" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/transcribed.png" class="img-fluid figure-img"></p>
  <figcaption>(b) Transcribed</figcaption>
  </figure>
  </div>
  </div>
  </div>
  </div>
  <figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orderbook-transcribed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  Figure&nbsp;3: Using the detected boundaries, we can automatically crop out the list of the purchaser names as shown in (a). This cropped image is them fed into Gemini, which returns the transcribed output in (b).
  </figcaption>
  </figure>
  </div>
  <p>All of this is put together in a pipeline that will allow for these financial records to be transcribed in bulk, and to reduce the human effort needed to transcribe these records, and otherwise correct them.</p>
  <p>My work continues on in finetuning the process of extracting the other columns of information from each image, using additional image manipulation techniques, modified prompting, and leveraging LLMs for data cleaning.</p>
  <div id="fig-orderbook-next-steps" class="quarto-layout-panel">
  <figure class="quarto-float quarto-float-fig figure">
  <div aria-describedby="fig-orderbook-next-steps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  <div class="quarto-layout-row">
  <div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
  <div id="orderbook-spliced" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/spliced.jpg" class="img-fluid figure-img"></p>
  <figcaption>Fig. 6. (a) Spliced</figcaption>
  </figure>
  </div>
  </div>
  <div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
  <div id="orderbook-spliced-transcribed" class="quarto-figure quarto-figure-center anchored">
  <figure class="figure">
  <p><img src="data/imgs/spliced_output.png" class="img-fluid figure-img"></p>
  <figcaption>(b) Transcribed</figcaption>
  </figure>
  </div>
  </div>
  </div>
  </div>
  <figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orderbook-next-steps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
  Figure&nbsp;4: Experimenting with splicing images in (a) to remove columns that are “distracting” for Gemini to read. The resulting transcription of this spliced image is shown in (b).
  </figcaption>
  </figure>
  </div>
  <p>In all, my work focuses on bringing born-analog texts into the modern age in order to further novel and unique inquiry into Woolf’s work and its continued influence.</p>
  
  
  </section>

    </main> <!-- /main -->
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const icon = "";
      const anchorJS = new window.AnchorJS();
      anchorJS.options = {
        placement: 'right',
        icon: icon
      };
      anchorJS.add('.anchored');
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const xrefs = window.document.querySelectorAll('a.quarto-xref');
      const processXRef = (id, note) => {
        // Strip column container classes
        const stripColumnClz = (el) => {
          el.classList.remove("page-full", "page-columns");
          if (el.children) {
            for (const child of el.children) {
              stripColumnClz(child);
            }
          }
        }
        stripColumnClz(note)
        if (id === null || id.startsWith('sec-')) {
          // Special case sections, only their first couple elements
          const container = document.createElement("div");
          if (note.children && note.children.length > 2) {
            container.appendChild(note.children[0].cloneNode(true));
            for (let i = 1; i < note.children.length; i++) {
              const child = note.children[i];
              if (child.tagName === "P" && child.innerText === "") {
                continue;
              } else {
                container.appendChild(child.cloneNode(true));
                break;
              }
            }
            if (window.Quarto?.typesetMath) {
              window.Quarto.typesetMath(container);
            }
            return container.innerHTML
          } else {
            if (window.Quarto?.typesetMath) {
              window.Quarto.typesetMath(note);
            }
            return note.innerHTML;
          }
        } else {
          // Remove any anchor links if they are present
          const anchorLink = note.querySelector('a.anchorjs-link');
          if (anchorLink) {
            anchorLink.remove();
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          // TODO in 1.5, we should make sure this works without a callout special case
          if (note.classList.contains("callout")) {
            return note.outerHTML;
          } else {
            return note.innerHTML;
          }
        }
      }
      for (var i=0; i<xrefs.length; i++) {
        const xref = xrefs[i];
        tippyHover(xref, undefined, function(instance) {
          instance.disable();
          let url = xref.getAttribute('href');
          let hash = undefined; 
          if (url.startsWith('#')) {
            hash = url;
          } else {
            try { hash = new URL(url).hash; } catch {}
          }
          if (hash) {
            const id = hash.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note !== null) {
              try {
                const html = processXRef(id, note.cloneNode(true));
                instance.setContent(html);
              } finally {
                instance.enable();
                instance.show();
              }
            } else {
              // See if we can fetch this
              fetch(url.split('#')[0])
              .then(res => res.text())
              .then(html => {
                const parser = new DOMParser();
                const htmlDoc = parser.parseFromString(html, "text/html");
                const note = htmlDoc.getElementById(id);
                if (note !== null) {
                  const html = processXRef(id, note);
                  instance.setContent(html);
                } 
              }).finally(() => {
                instance.enable();
                instance.show();
              });
            }
          } else {
            // See if we can fetch a full url (with no hash to target)
            // This is a special case and we should probably do some content thinning / targeting
            fetch(url)
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.querySelector('main.content');
              if (note !== null) {
                // This should only happen for chapter cross references
                // (since there is no id in the URL)
                // remove the first header
                if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                  note.children[0].remove();
                }
                const html = processXRef(null, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        }, function(instance) {
        });
      }
          let selectedAnnoteEl;
          const selectorForAnnotation = ( cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' +  annotation + '"';
            const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
            return selector;
          }
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
            const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            })
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
                //compute the position of the single el (top and bottom and make a div)
                const el = window.document.getElementById(lineIds[0]);
                top = el.offsetTop;
                height = el.offsetHeight;
                parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it 
                let div = window.document.getElementById("code-annotation-line-highlight");
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = 'absolute';
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                  gutterDiv.style.position = 'absolute';
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector('.code-annotation-gutter');
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
          // Attach click handler to the DT
          const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
          for (const annoteDlNode of annoteDls) {
            annoteDlNode.addEventListener('click', (event) => {
              const clickedEl = event.target;
              if (clickedEl !== selectedAnnoteEl) {
                unselectCodeLines();
                const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
                if (activeEl) {
                  activeEl.classList.remove('code-annotation-active');
                }
                selectCodeLines(clickedEl);
                clickedEl.classList.add('code-annotation-active');
              } else {
                // Unselect the line
                unselectCodeLines();
                clickedEl.classList.remove('code-annotation-active');
              }
            });
          }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    </div> <!-- /content -->
  


</body></html>
